<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desbloqueando a Ansiedade</title>
    <!-- Chosen Palette: Calm Neutrals with Blue Accents -->
    <!-- Application Structure Plan: This version enhances the interactive quiz by implementing tiered results (Low, Moderate, High anxiety levels) with specific interpretive messages. The core SPA structure (header, content sections, footer) remains, ensuring smooth navigation. The quiz result display is updated to present these new, more meaningful levels, directly addressing the user's request for more actionable feedback. -->
    <!-- Visualization & Content Choices: Report Info: Anxiety self-assessment -> Goal: Provide a more insightful and actionable self-evaluation -> Viz/Method: Checkbox-based questionnaire, JavaScript logic for score calculation and tiered result interpretation, dynamic text display with tailored advice for each level. -> Interaction: Users select symptoms, click a button, and receive a categorized result with contextual guidance. Justification: Enhances the quiz's utility by offering qualitative feedback beyond a simple count, making it more valuable for self-understanding. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-color: #f3f4f6;
            --text-color: #1f2937;
            --card-bg-color: #ffffff;
            --header-bg-color: #e5e7eb;
            --primary-color: #3b82f6;
            --primary-hover-color: #2563eb;
            --icon-color: #4b5563;
        }

        html.dark {
            --bg-color: #1f2937;
            --text-color: #d1d5db;
            --card-bg-color: #374151;
            --header-bg-color: #4b5563;
            --primary-color: #60a5fa;
            --primary-hover-color: #93c5fd;
            --icon-color: #d1d5db;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
            overflow-x: hidden; /* Prevent horizontal scroll */
        }

        .ebook-section {
            display: none;
            opacity: 0;
            transition: opacity 0.4s ease-in-out;
            overflow-x: hidden; /* Prevent horizontal scroll within sections */
        }
        
        .ebook-section.active {
            display: block;
            opacity: 1;
        }

        .ebook-container {
            background-color: var(--card-bg-color);
            transition: background-color 0.3s;
        }

        .control-header {
            background-color: var(--header-bg-color);
            transition: background-color 0.3s;
        }
        
        .control-button, .dropdown-toggle {
            color: var(--icon-color);
        }

        /* Common list styling */
        .custom-list li::before { color: var(--primary-color); }
        .checkmark-list li::before, .square-list li::before, .leaf-list li::before, .sleep-list li::before, .walk-list li::before, .sun-list li::before, .brain-list li::before, .trigger-list li::before, .quiz-list li::before, .relax-list li::before, .tea-list li::before, .recipe-list li::before, .exercise-list li::before { font-size: 1.2em; line-height: 1; position: absolute; left: 0; }
        .custom-list li, .checkmark-list li, .square-list li, .leaf-list li, .sleep-list li, .walk-list li, .sun-list li, .brain-list li, .trigger-list li, .quiz-list li, .relax-list li, .tea-list li, .recipe-list li, .exercise-list li { position: relative; padding-left: 1.8em; margin-bottom: 0.5em; }
        .custom-list li::before { content: '‚Ä¢'; font-weight: bold; }
        .checkmark-list li::before { content: '‚úÖ'; }
        .square-list li::before { content: 'üü¶'; }
        .leaf-list li::before { content: 'üåø'; }
        .sleep-list li::before { content: 'üí§'; }
        .walk-list li::before { content: 'üö∂‚Äç‚ôÇÔ∏è'; }
        .sun-list li::before { content: '‚òÄÔ∏è'; }
        .brain-list li::before { content: 'üß†'; }
        .trigger-list li::before { content: 'üö´'; }
        .quiz-list li::before { content: 'üìù'; }
        .relax-list li::before { content: 'üßò‚Äç‚ôÄÔ∏è'; }
        .tea-list li::before { content: 'üçµ'; }
        .recipe-list li::before { content: 'ü•ó'; }
        .exercise-list li::before { content: 'üèÉ'; }

        .conclusion-star::before { content: 'üåü'; margin-right: 0.5em; }
        .author-envelope::before { content: '‚úâÔ∏è'; margin-right: 0.5em; }
        h2 { color: var(--primary-color); transition: color 0.3s; }
        a.asmr-link { color: var(--primary-color); text-decoration: underline; }
        a.asmr-link:hover { color: var(--primary-hover-color); }

        #fontSizeIndicator { font-size: 0.75rem; width: 2.5rem; text-align: center; }

        /* AI Feature specific styling */
        .affirmation-display, .topic-response {
            margin-top: 1.5rem;
            padding: 1rem;
            border-radius: 0.5rem;
            background-color: var(--header-bg-color);
            border: 1px solid var(--primary-color);
            color: var(--text-color);
            text-align: center;
            font-weight: bold;
            min-height: 80px; /* Ensure space even when empty */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ai-loading-indicator {
            text-align: center;
            margin-top: 0.5rem;
            color: var(--primary-color);
        }

        .ai-input-area {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        .ai-input-area textarea {
            flex-grow: 1;
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid var(--header-bg-color);
            background-color: var(--card-bg-color);
            color: var(--text-color);
            resize: vertical;
            min-height: 40px;
        }
        .ai-input-area button {
            background-color: var(--primary-color);
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .ai-input-area button:hover {
            background-color: var(--primary-hover-color);
        }
        .affirmation-icon::before { content: '‚ú®'; margin-right: 0.5em; }
        .topic-icon::before { content: 'üí°'; margin-right: 0.5em; }

        /* Video container styling */
        .video-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
            height: 0;
            overflow: hidden;
            border-radius: 0.75rem;
            margin-bottom: 1.5rem;
            background-color: #000; /* Fallback for video loading */
        }
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        /* Custom Message Box */
        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--card-bg-color);
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            text-align: center;
            display: none;
        }
        .message-box button {
            margin-top: 1rem;
            padding: 0.5rem 1rem;
            background-color: var(--primary-color);
            color: white;
            border-radius: 0.5rem;
            cursor: pointer;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-4xl mx-auto">
        <!-- Header with Controls -->
        <header class="control-header sticky top-0 z-10 w-full max-w-4xl mx-auto bg-gray-200 rounded-t-lg shadow-md p-2 flex items-center justify-between">
            <!-- Navigation Menu -->
            <div class="relative">
                <button id="menuBtn" aria-label="Abrir menu de cap√≠tulos" class="dropdown-toggle px-3 py-2 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 focus:outline-none">
                    <i class="fas fa-bars"></i> Menu
                </button>
                <nav id="navMenu" class="hidden absolute left-0 mt-2 w-72 bg-white dark:bg-gray-700 rounded-md shadow-lg py-1 z-20">
                    <!-- Menu items will be inserted here by JS -->
                </nav>
            </div>
            <!-- Font Size Controls -->
            <div class="flex items-center">
                <button id="decreaseFontBtn" aria-label="Diminuir tamanho da fonte" class="control-button p-2 rounded-full hover:bg-gray-300 dark:hover:bg-gray-600"><i class="fas fa-minus"></i></button>
                <span id="fontSizeIndicator" class="text-gray-700 dark:text-gray-300">100%</span>
                <button id="increaseFontBtn" aria-label="Aumentar tamanho da fonte" class="control-button p-2 rounded-full hover:bg-gray-300 dark:hover:bg-gray-600"><i class="fas fa-plus"></i></button>
            </div>
            <!-- Dark Mode Toggle -->
            <div class="flex items-center">
                <i class="fas fa-sun mr-2 text-yellow-500"></i>
                <label for="darkModeToggle" class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" id="darkModeToggle" class="sr-only peer">
                    <div class="w-11 h-6 bg-gray-400 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                </label>
                <i class="fas fa-moon ml-2 text-blue-400"></i>
            </div>
        </header>

        <!-- Ebook Content -->
        <main class="ebook-container w-full max-w-4xl mx-auto shadow-lg rounded-b-lg flex flex-col justify-between" style="min-height: 80vh;">
            <div id="contentArea" class="p-4 sm:p-6 md:p-8">
                 <div id="section-0" class="ebook-section">
                    <img src="https://placehold.co/800x200/ADD8E6/000000?text=Desbloqueando+a+Ansiedade" alt="[Imagem de uma paisagem calma com o nascer do sol]" class="w-full h-auto rounded-lg mb-6 shadow-md">
                    <h1 class="text-4xl font-bold text-center mb-4"><span class="text-5xl">üìò</span> Desbloqueando a Ansiedade</h1>
                    <p class="text-xl text-center font-semibold">Por Felipe Gondim</p>
                </div>
                <div id="section-1" class="ebook-section"><h2 class="text-3xl font-bold mb-4 author-envelope">Introdu√ß√£o</h2><p class="mb-4">Voc√™ j√° sentiu seu cora√ß√£o disparar sem motivo aparente? J√° se pegou preso em pensamentos que parecem n√£o ter fim?</p><p class="mb-4">Se sim, voc√™ n√£o est√° sozinho...</p><img src="https://placehold.co/800x150/CCE0FB/000000?text=Bem-vindo+ao+Guia" alt="[Imagem de m√£os abertas em um gesto de conforto]" class="w-full h-auto rounded-lg mt-6 shadow-sm"></div>
                <div id="section-2" class="ebook-section"><h2 class="text-3xl font-bold mb-4">1. O que √© a ansiedade?</h2><p class="mb-4">Ansiedade √© uma rea√ß√£o natural do corpo...</p><p class="font-semibold mb-2">Sinais comuns:</p><ul class="custom-list"><li>Preocupa√ß√£o excessiva</li><li>Tens√£o muscular</li><li>Pensamentos acelerados</li></ul><img src="https://placehold.co/800x150/D1E7DD/000000?text=Entendendo+a+Ansiedade" alt="[Imagem de um c√©rebro com sinos de alarme tocando]" class="w-full h-auto rounded-lg mt-6 shadow-sm"></div>
                <div id="section-3" class="ebook-section"><h2 class="text-3xl font-bold mb-4">2. Tipos mais comuns</h2><ul class="checkmark-list"><li class="mb-3"><span class="font-semibold">Transtorno de Ansiedade Generalizada (TAG)</span><br>Ansiedade constante...</li><li class="mb-3"><span class="font-semibold">S√≠ndrome do P√¢nico</span><br>Crises intensas...</li></ul><img src="https://placehold.co/800x150/F8D7DA/000000?text=Tipos+de+Ansiedade" alt="[Imagem de v√°rios rostos preocupados representando diferentes tipos de ansiedade]" class="w-full h-auto rounded-lg mt-6 shadow-sm"></div>
                <div id="section-4" class="ebook-section"><h2 class="text-3xl font-bold mb-4">3. Como afeta corpo e mente</h2><p class="mb-4">A mente ansiosa vive no futuro...</p><ul class="custom-list"><li>Libera√ß√£o de cortisol (horm√¥nio do estresse)</li><li>Sistema nervoso em alerta constante</li></ul><p class="text-gray-800">Com o tempo, a ansiedade rouba a energia, o foco e a qualidade de vida.</p><img src="https://placehold.co/800x150/D6E9C2/000000?text=Corpo+e+Mente" alt="[Imagem de uma pessoa com pensamentos girando e tens√£o f√≠sica]" class="w-full h-auto rounded-lg mt-6 shadow-sm"></div>
                
                <!-- QUIZ SECTION -->
                <div id="section-5" class="ebook-section">
                    <h2 class="text-3xl font-bold mb-4">4. üìù Seu Teste de Ansiedade Simples</h2>
                    <p class="mb-6">Marque as caixas para os itens que voc√™ experimentou com frequ√™ncia nas √∫ltimas semanas. Este √© um teste simples para autoavalia√ß√£o, n√£o um diagn√≥stico profissional.</p>
                    <div id="quizQuestionsContainer" class="space-y-3">
                        <!-- Questions will be rendered here by JavaScript -->
                    </div>
                    <button id="calculateQuizResultBtn" class="mt-8 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 shadow-md w-full sm:w-auto">Ver Resultado</button>
                    <div id="quizResultDisplay" class="quiz-result hidden">
                        <!-- Result will be displayed here -->
                    </div>
                    <img src="https://placehold.co/800x150/A3DA8D/000000?text=Teste+Seus+Sintomas" alt="[Image of a survey form with a pen]" class="w-full h-auto rounded-lg mt-6 shadow-sm">
                </div>
                <!-- END QUIZ SECTION -->

                <!-- UPDATED SECTION: 5. T√©cnicas pr√°ticas -->
                <div id="section-6" class="ebook-section">
                    <h2 class="text-3xl font-bold mb-4">5. T√©cnicas pr√°ticas</h2>
                    <p class="mb-4">Voc√™ n√£o precisa eliminar a ansiedade ‚Äî precisa aprender a andar com ela. Aqui v√£o t√©cnicas simples que funcionam:</p>
                    <ul class="pl-5">
                        <li class="mb-3 square-list">
                            <span class="font-semibold">Respira√ß√£o 4-7-8</span><br>
                            <ol class="list-decimal pl-5 mt-1">
                                <li>Inspire silenciosamente pelo nariz contando mentalmente at√© 4.</li>
                                <li>Prenda a respira√ß√£o contando mentalmente at√© 7.</li>
                                <li>Expire completamente pela boca, fazendo um som de "sopro" enquanto conta mentalmente at√© 8.</li>
                            </ol>
                            <p class="mt-1">Repita este ciclo por pelo menos 3 minutos ou at√© sentir-se mais calmo(a).</p>
                        </li>
                        <li class="mb-3 square-list">
                            <span class="font-semibold">Escrita livre</span><br>
                            Pegue papel e caneta (ou use um aplicativo de notas) e escreva tudo o que est√° sentindo, pensando e preocupando voc√™, sem censura ou julgamento. N√£o se preocupe com gram√°tica ou coer√™ncia. O objetivo √© esvaziar a mente. Descarte o papel depois, se desejar.
                        </li>
                        <li class="mb-3 square-list">
                            <span class="font-semibold">Acalme o corpo</span><br>
                            Conecte-se com seu corpo para enviar sinais de seguran√ßa ao c√©rebro:
                            <ul class="list-disc pl-5 mt-1">
                                <li>**Banho quente:** O calor relaxa os m√∫sculos e acalma a mente.</li>
                                <li>**Alongamento suave:** Libera a tens√£o acumulada nos m√∫sculos.</li>
                                <li>**Massagem nos ombros ou t√™mporas:** Alivia pontos de estresse.</li>
                                <li>**Caminhada curta em ambiente tranquilo:** O movimento r√≠tmico pode ser meditativo.</li>
                            </ul>
                        </li>
                        <li class="mb-3 square-list">
                            <span class="font-semibold">Nomeie o que sente</span><br>
                            Quando sentir a ansiedade subindo, tente dar um nome √† emo√ß√£o. Por exemplo: ‚ÄúEstou sentindo medo agora‚Äù, ‚ÄúEstou inseguro(a) com esta situa√ß√£o‚Äù, ‚ÄúEstou frustrado(a)‚Äù. Nomear a emo√ß√£o ajuda a diminuir seu impacto, pois a transforma de uma sensa√ß√£o vaga em algo identific√°vel e, portanto, mais control√°vel.
                        </li>
                    </ul>
                    <img src="https://placehold.co/800x150/C1E1C1/000000?text=Controle+em+Suas+M√£os" alt="[Imagem de uma pessoa praticando respira√ß√£o profunda]" class="w-full h-auto rounded-lg mt-6 shadow-sm">
                </div>
                <!-- END UPDATED SECTION -->

                <!-- UPDATED SECTION: 6. Lidar com crises (now includes extreme tip) -->
                <div id="section-7" class="ebook-section">
                    <h2 class="text-3xl font-bold mb-4">6. Lidar com crises</h2>
                    <p class="mb-4">Durante uma crise de ansiedade, √© crucial tentar focar em t√©cnicas que te ajudem a reconectar com o presente e a acalmar seu corpo. Lembre-se: "Isso √© uma crise, vai passar."</p>
                    <ul class="list-decimal pl-5 custom-list">
                        <li>**Reconhe√ßa:** Diga a si mesmo(a): ‚ÄúIsso √© uma crise de ansiedade, vai passar.‚Äù Aceitar o que est√° acontecendo sem lutar contra isso pode diminuir a intensidade.</li>
                        <li>**Sente-se:** Se poss√≠vel, sente-se em um local seguro. Evite ficar de p√© ou andando rapidamente, o que pode aumentar a sensa√ß√£o de descontrole.</li>
                        <li>**Respire lentamente:** Use a t√©cnica de Respira√ß√£o 4-7-8 (do cap√≠tulo anterior) ou qualquer outra respira√ß√£o profunda e controlada para regular sua respira√ß√£o.</li>
                        <li>**Use o ASMR:** Se tiver acesso, o √°udio ASMR (link na pr√≥xima p√°gina) pode ser um poderoso aliado para desviar o foco e induzir relaxamento.</li>
                    </ul>
                    <p class="mt-4">Nunca lute contra a crise. Aceite e espere ela passar ‚Äî e ela vai.</p>

                    <h3 class="text-2xl font-bold mt-8 mb-3 text-red-600 dark:text-red-400">üö® Dica Extrema de Bombeiros para Crises Severas üö®</h3>
                    <p class="mb-4 font-semibold">**Aten√ß√£o:** Esta t√©cnica √© para crises de ansiedade *extremas* e pode ser muito intensa. Consulte um profissional de sa√∫de antes de tentar, especialmente se tiver qualquer condi√ß√£o m√©dica preexistente (card√≠aca, respirat√≥ria, etc.).</p>
                    <ul class="exercise-list pl-5">
                        <li class="mb-3">
                            <span class="font-semibold">T√©cnica do Balde de √Ågua Gelada:</span><br>
                            - Encha um balde com √°gua fria e adicione alguns cubos de gelo.<br>
                            - Prenda a respira√ß√£o e mergulhe o rosto na √°gua gelada por 10 a 30 segundos (ou o m√°ximo que conseguir confortavelmente).<br>
                            - Retire o rosto e respire profundamente.<br>
                            Esta a√ß√£o ativa o "reflexo de mergulho" mam√≠fero, que diminui drasticamente a frequ√™ncia card√≠aca e contrai os vasos sangu√≠neos, redirecionando o fluxo sangu√≠neo e podendo interromper a resposta de luta ou fuga associada √† crise.
                        </li>
                    </ul>
                    <img src="https://placehold.co/800x150/F0E68C/000000?text=Superando+a+Crise" alt="[Imagem de uma pessoa sentada calmamente, respirando profundamente]" class="w-full h-auto rounded-lg mt-6 shadow-sm">
                </div>
                <!-- END UPDATED SECTION -->

                <div id="section-8" class="ebook-section"><h2 class="text-3xl font-bold mb-4">7. Estilo de vida</h2><ul class="leaf-list"><li>Alimente-se bem</li></ul><img src="https://placehold.co/800x150/ADD8E6/000000?text=Vida+Equilibrada" alt="[Imagem de v√°rios elementos de estilo de vida saud√°vel como alimentos, sono, exerc√≠cios]" class="w-full h-auto rounded-lg mt-6 shadow-sm"></div>
                <div id="section-9" class="ebook-section"><h2 class="text-3xl font-bold mb-4">8. Aliado: ASMR</h2><p class="mb-4">O ASMR √© uma sensa√ß√£o de relaxamento...</p><p>üëâ <a href="#" id="asmrLink" class="asmr-link"> [Inserir link do v√≠deo aqui]</a></p><img src="https://placehold.co/800x150/D3F8D3/000000?text=O+Poder+do+ASMR" alt="[Imagem de uma pessoa ouvindo fones de ouvido com uma express√£o calma]" class="w-full h-auto rounded-lg mt-6 shadow-sm"></div>
                <div id="section-10" class="ebook-section"><h2 class="text-3xl font-bold mb-4">9. Evitando Gatilhos</h2><ul class="trigger-list"><li>Fa√ßa uma "Dieta de Not√≠cias"</li></ul><img src="https://placehold.co/800x150/FFC0CB/000000?text=Protegendo+Sua+Mente" alt="[Imagem de uma pessoa se protegendo de m√≠dias negativas]" class="w-full h-auto rounded-lg mt-6 shadow-sm"></div>

                <!-- AI PSYCHOLOGIST SECTION -->
                <div id="section-11" class="ebook-section">
                    <h2 class="text-3xl font-bold mb-4 chat-icon">10. ü§ñ Pergunte √† IA</h2>
                    <p class="mb-4">Assista ao v√≠deo abaixo para uma mensagem de boas-vindas da sua IA Psic√≥loga! Em seguida, use a caixa de texto para desabafar ou fazer perguntas gerais sobre ansiedade e bem-estar mental.</p>
                    <div class="video-container">
                        <!-- REPLACE THIS YOUTUBE EMBED WITH YOUR VEO VIDEO EMBED CODE -->
                        <iframe 
                            src="https://www.youtube.com/embed/dQw4w9WgXcQ?controls=0&modestbranding=1&rel=0" 
                            frameborder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                            allowfullscreen 
                            title="V√≠deo de Boas-vindas da IA Psic√≥loga (Placeholder)">
                        </iframe>
                    </div>
                    <p class="mb-4">**Lembre-se: Esta √© uma intelig√™ncia artificial e n√£o substitui de forma alguma o aconselhamento ou diagn√≥stico de um profissional de sa√∫de mental.**</p>
                    <div id="chatDisplay" class="chat-container">
                        <!-- Initial AI message added by JS -->
                    </div>
                    <div class="ai-input-area">
                        <textarea id="chatInput" placeholder="Digite sua pergunta aqui..." rows="1"></textarea>
                        <button id="sendChatBtn"><i class="fas fa-paper-plane"></i> Enviar</button>
                    </div>
                    <div id="loadingIndicator" class="ai-loading-indicator hidden">
                        <i class="fas fa-spinner fa-spin"></i> Digitando...
                    </div>
                    <img src="https://placehold.co/800x150/C0C0C0/000000?text=Converse+com+a+IA" alt="[Imagem de uma interface de chatbot de IA]" class="w-full h-auto rounded-lg mt-6 shadow-sm">
                </div>
                <!-- END AI PSYCHOLOGIST SECTION -->

                <!-- NEW SECTION: POSITIVE AFFIRMATION GENERATOR -->
                <div id="section-12" class="ebook-section">
                    <h2 class="text-3xl font-bold mb-4 affirmation-icon">11. ‚ú® Gerador de Afirma√ß√µes Positivas</h2>
                    <p class="mb-4">Uma afirma√ß√£o positiva pode ser uma ferramenta poderosa para mudar o foco da sua mente e cultivar uma perspectiva mais otimista. Clique no bot√£o abaixo para gerar uma nova afirma√ß√£o!</p>
                    <button id="generateAffirmationBtn" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 shadow-md">Gerar Afirma√ß√£o ‚ú®</button>
                    <div id="affirmationDisplay" class="affirmation-display mt-6 italic text-lg">
                        Clique em "Gerar Afirma√ß√£o" para come√ßar!
                    </div>
                    <div id="affirmationLoadingIndicator" class="ai-loading-indicator hidden">
                        <i class="fas fa-spinner fa-spin"></i> Gerando afirma√ß√£o...
                    </div>
                    <img src="https://placehold.co/800x150/CDEBFF/000000?text=Afirma√ß√µes+Positivas" alt="[Imagem de m√£os segurando uma l√¢mpada brilhante, representando uma ideia positiva]" class="w-full h-auto rounded-lg mt-6 shadow-sm">
                </div>
                <!-- END NEW SECTION -->

                <!-- NEW SECTION: TOPIC EXPANDER -->
                <div id="section-13" class="ebook-section">
                    <h2 class="text-3xl font-bold mb-4 topic-icon">12. üí° Expansor de T√≥picos (Pergunte ao E-book)</h2>
                    <p class="mb-4">Quer explorar um t√≥pico espec√≠fico do e-book com mais detalhes ou tem uma pergunta geral sobre ansiedade e bem-estar? Digite abaixo e a IA fornecer√° uma resposta complementar.</p>
                    <div class="ai-input-area">
                        <textarea id="topicInput" placeholder="Ex: 'Explique mais sobre o cortisol' ou 'Como o sono afeta a ansiedade?'" rows="3" class="w-full p-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700"></textarea>
                        <button id="askTopicBtn" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 shadow-md">Perguntar</button>
                    </div>
                    <div id="topicLoadingIndicator" class="ai-loading-indicator hidden">
                        <i class="fas fa-spinner fa-spin"></i> Pensando...
                    </div>
                    <div id="topicResponseDisplay" class="topic-response mt-6 text-left">
                        Aguardando sua pergunta.
                    </div>
                    <p class="mt-4 text-sm text-center">**Aviso:** A IA fornece informa√ß√µes gerais e n√£o substitui o aconselhamento profissional de sa√∫de mental.</p>
                    <img src="https://placehold.co/800x150/DCEBFF/000000?text=Expanda+Seu+Conhecimento" alt="[Imagem de uma pessoa lendo um livro com uma l√¢mpada acima da cabe√ßa]" class="w-full h-auto rounded-lg mt-6 shadow-sm">
                </div>
                <!-- END NEW SECTION -->

                <div id="section-14" class="ebook-section"><h2 class="text-3xl font-bold mb-4">13. T√©cnicas Aprofundadas de Relaxamento e Respira√ß√£o</h2><p class="mb-4">Al√©m das t√©cnicas b√°sicas, explore m√©todos mais profundos para acalmar a mente e o corpo, promovendo um relaxamento duradouro.</p><ul class="relax-list pl-5"><li><span class="font-semibold">Medita√ß√£o Guiada:</span> Encontre um local tranquilo, sente-se confortavelmente e siga um √°udio de medita√ß√£o guiada. Existem diversos aplicativos e v√≠deos gratuitos online.</li><li><span class="font-semibold">Relaxamento Muscular Progressivo (RMP):</span> Deite-se e comece a tensionar e relaxar cada grupo muscular do corpo, um por um, come√ßando pelos p√©s e subindo at√© a cabe√ßa. Mantenha a tens√£o por 5 segundos e relaxe por 15. Observe a diferen√ßa entre a tens√£o e o relaxamento.</li><li><span class="font-semibold">Escaneamento Corporal (Body Scan):</span> Deite-se de costas, feche os olhos e direcione sua aten√ß√£o para diferentes partes do corpo, desde os p√©s at√© a cabe√ßa, observando qualquer sensa√ß√£o (formigamento, calor, frio, tens√£o) sem julgamento. Respire para cada √°rea que voc√™ foca.</li><li><span class="font-semibold">Respira√ß√£o Diafragm√°tica (Abdominal):</span> Coloque uma m√£o no peito e outra no abd√¥men. Ao inspirar, sinta o abd√¥men se expandir, enquanto o peito permanece relativamente im√≥vel. Expire lentamente, sentindo o abd√¥men contrair. Esta respira√ß√£o profunda aciona o sistema nervoso parassimp√°tico, promovendo o relaxamento.</li></ul><img src="https://placehold.co/800x150/B8D8F4/000000?text=T√©cnicas+de+Relaxamento" alt="[Imagem de uma pessoa meditando pacificamente]" class="w-full h-auto rounded-lg mt-6 shadow-sm"></div>
                <div id="section-15" class="ebook-section"><h2 class="text-3xl font-bold mb-4">14. üçµ Ch√°s e Ervas Calmantes para Ansiedade</h2><p class="mb-4">A natureza oferece aliados poderosos no combate √† ansiedade. Conhe√ßa alguns ch√°s e ervas que podem ajudar a acalmar o sistema nervoso e promover o bem-estar.</p><ul class="tea-list pl-5"><li><span class="font-semibold">Camomila:</span> Conhecida por suas propriedades calmantes, a camomila √© uma das ervas mais populares para relaxamento. Ajuda a reduzir a ins√¥nia e a ansiedade leve. Prepare por infus√£o das flores secas.</li><li><span class="font-semibold">Cidreira (Melissa):</span> Com um aroma c√≠trico suave, a cidreira √© excelente para aliviar o estresse, a ansiedade e a ins√¥nia. Ela pode melhorar o humor e a qualidade do sono.</li><li><span class="font-semibold">Passiflora (Maracuj√°):</span> A passiflora √© amplamente utilizada por suas propriedades sedativas e ansiol√≠ticas. Ajuda a reduzir a agita√ß√£o e a promover um sono mais tranquilo.</li><li><span class="font-semibold">Valeriana:</span> Uma erva potente, a valeriana √© frequentemente usada para tratar a ins√¥nia e a ansiedade mais severa. Recomenda-se cautela no uso e, se poss√≠vel, consultar um profissional de sa√∫de, pois pode interagir com medicamentos.</li><li><span class="font-semibold">Ch√° Verde (com modera√ß√£o):</span> Embora contenha cafe√≠na, o ch√° verde tamb√©m possui L-teanina, um amino√°cido que promove relaxamento sem causar sonol√™ncia. Consuma com modera√ß√£o, especialmente se for sens√≠vel √† cafe√≠na.</li></ul><img src="https://placehold.co/800x150/D1F0E0/000000?text=Ch√°s+Calmantes" alt="[Image of various calming tea herbs and teacups]" class="w-full h-auto rounded-lg mt-6 shadow-sm"></div>
                <div id="section-16" class="ebook-section"><h2 class="text-3xl font-bold mb-4">15. ü•ó Receitas para Nutrir a Mente</h2><p class="mb-4">Uma alimenta√ß√£o consciente e rica em nutrientes pode ser uma grande aliada contra a ansiedade. Ingredientes espec√≠ficos podem ajudar a modular o humor e a reduzir o estresse. Experimente estas receitas exclusivas:</p><ul class="recipe-list pl-5"><li><span class="font-semibold">Smoothie da Calma:</span><br>- 1 banana madura (rica em triptofano)<br>- 1/2 x√≠cara de aveia (carboidratos complexos)<br>- 1 colher de sopa de sementes de chia (√¥mega-3)<br>- 1 x√≠cara de leite vegetal (am√™ndoa, coco)<br>- Uma pitada de canela (para sabor e propriedades antioxidantes)<br>Bata tudo no liquidificador at√© ficar homog√™neo. Ideal para um caf√© da manh√£ ou lanche relaxante.</li><li><span class="font-semibold">Salada Zen de Folhas Verdes e Abacate:</span><br>- Mix de folhas verdes escuras (espinafre, couve - magn√©sio)<br>- 1/2 abacate fatiado (gorduras saud√°veis)<br>- Um punhado de nozes ou castanhas (√¥mega-3, zinco)<br>- Tomates cereja e pepino a gosto<br>- Molho leve: azeite de oliva extra virgem, suco de lim√£o, sal e pimenta. Uma refei√ß√£o leve e nutritiva que contribui para o bem-estar mental.</li><li><span class="font-semibold">Chocolate Quente Relaxante (Vers√£o Saud√°vel):</span><br>- 1 x√≠cara de leite vegetal (coco, aveia)<br>- 2 colheres de sopa de cacau em p√≥ sem a√ß√∫car (antioxidantes)<br>- 1 colher de ch√° de mel ou xarope de bordo (ado√ßante natural)<br>- Uma pitada de canela ou noz-moscada<br>Aque√ßa o leite vegetal, adicione o cacau e o ado√ßante, mexendo bem. Finalize com a especiaria de sua prefer√™ncia. Perfeito para um momento de autocuidado antes de dormir.</li></ul><img src="https://placehold.co/800x150/E0F0D8/000000?text=Receitas+Saud√°veis" alt="[Image of healthy ingredients like fruits, vegetables, and nuts]" class="w-full h-auto rounded-lg mt-6 shadow-sm"></div>
                <div id="section-17" class="ebook-section"><h2 class="text-3xl font-bold mb-4 exercise-list">16. üèÉ‚Äç‚ôÄÔ∏è A Import√¢ncia dos Exerc√≠cios F√≠sicos para a Ansiedade</h2><p class="mb-4">O exerc√≠cio f√≠sico √© uma ferramenta poderosa e natural no combate √† ansiedade e no fomento do bem-estar mental. Ele n√£o s√≥ melhora a sa√∫de do corpo, mas tamb√©m tem um impacto significativo na sua mente.</p><p class="mb-6">Entenda como a atividade f√≠sica pode ser sua aliada:</p><h3 class="text-2xl font-bold mb-3 text-blue-600 dark:text-blue-400">Principais Benef√≠cios:</h3><ul class="exercise-list pl-5"><li><span class="font-semibold">Libera√ß√£o de Endorfinas:</span> Conhecidas como "horm√¥nios do bem-estar", as endorfinas s√£o liberadas durante o exerc√≠cio, promovendo uma sensa√ß√£o natural de euforia e relaxamento.</li><li><span class="font-semibold">Redu√ß√£o do Cortisol:</span> O exerc√≠cio regular ajuda a regular os n√≠veis de cortisol, o horm√¥nio do estresse, que em excesso pode agravar a ansiedade.</li><li><span class="font-semibold">Melhora do Sono:</span> A atividade f√≠sica regular, especialmente se feita algumas horas antes de dormir, contribui para um sono mais profundo e reparador, essencial para a sa√∫de mental.</li><li><span class="font-semibold">Aumento da Autoestima e Autoconfian√ßa:</span> Conquistar metas de exerc√≠cio e observar melhorias no corpo e na mente fortalece a autoimagem.</li><li><span class="font-semibold">Distra√ß√£o e Foco no Presente:</span> Durante o exerc√≠cio, sua mente se concentra na atividade, desviando o foco de preocupa√ß√µes e pensamentos ansiosos.</li><li><span class="font-semibold">Melhora da Sa√∫de F√≠sica Geral:</span> Um corpo saud√°vel suporta uma mente mais resiliente.</li></ul><h3 class="text-2xl font-bold mb-3 text-blue-600 dark:text-blue-400">Tipos de Exerc√≠cios Recomendados:</h3><ul class="exercise-list pl-5"><li><span class="font-semibold">Atividades Aer√≥bicas:</span> Caminhada r√°pida, corrida, nata√ß√£o, ciclismo, dan√ßa. S√£o √≥timas para a libera√ß√£o de endorfinas.</li><li><span class="font-semibold">Exerc√≠cios Mente-Corpo:</span> Yoga, Pilates, Tai Chi. Combinam movimento com t√©cnicas de respira√ß√£o e medita√ß√£o, focando no bem-estar integral.</li><li><span class="font-semibold">Treino de For√ßa:</span> Levantamento de pesos ou exerc√≠cios com peso corporal. Ajuda a construir disciplina e a melhorar a imagem corporal.</li></ul><p class="mt-4">Comece devagar, encontre uma atividade que voc√™ realmente goste e tente ser consistente. Seu corpo e sua mente agradecer√£o!</p><img src="https://placehold.co/800x150/C1DFF0/000000?text=Movimente-se+Pelo+Bem-Estar" alt="[Image of a person running happily outdoors]" class="w-full h-auto rounded-lg mt-6 shadow-sm"></div>
                <div id="section-18" class="ebook-section"><h2 class="text-3xl font-bold mb-4 conclusion-star">17. Conclus√£o</h2><p class="mb-4">A ansiedade n√£o precisa ser uma inimiga...</p><img src="https://placehold.co/800x150/B0E0E6/000000?text=Seu+Caminho+Come√ßa+Aqui" alt="[Image of a path leading towards a bright horizon]" class="w-full h-auto rounded-lg mt-6 shadow-sm"></div>
                <div id="section-19" class="ebook-section"><h2 class="text-3xl font-bold mb-4 author-envelope">18. Sobre o autor</h2><p class="mb-4">Felipe Gondim...</p><img src="https://placehold.co/800x150/D8BFD8/000000?text=Felipe+Gondim" alt="[Image of a person writing or creating content]" class="w-full h-auto rounded-lg mt-6 shadow-sm"></div>
            </div>

            <!-- Footer with Navigation and Progress -->
            <div class="flex justify-between items-center mt-8 p-4 border-t border-gray-200 dark:border-gray-600">
                <button id="prevBtn" aria-label="P√°gina anterior" class="px-5 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 dark:bg-opacity-80 dark:hover:bg-opacity-100 transition-colors shadow-md"><i class="fas fa-arrow-left"></i></button>
                <div id="progress-indicator" class="text-sm text-gray-600 dark:text-gray-400"></div>
                <button id="nextBtn" aria-label="Pr√≥xima p√°gina" class="px-5 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 dark:bg-opacity-80 dark:hover:bg-opacity-100 transition-colors shadow-md"><i class="fas fa-arrow-right"></i></button>
            </div>
        </main>
    </div>

    <!-- Custom Message Box for ASMR link -->
    <div id="messageBox" class="message-box">
        <p id="messageText"></p>
        <button id="closeMessageBox">Fechar</button>
    </div>

    <script>
        const sections = [
            { id: 'section-0', title: 'Capa' },
            { id: 'section-1', title: 'Introdu√ß√£o' },
            { id: 'section-2', title: '1. O que √© a ansiedade?' },
            { id: 'section-3', title: '2. Tipos mais comuns' },
            { id: 'section-4', title: '3. Como afeta o corpo' },
            { id: 'section-5', title: '4. Seu Teste de Ansiedade Simples' },
            { id: 'section-6', title: '5. T√©cnicas pr√°ticas' },
            { id: 'section-7', title: '6. Lidar com crises' },
            { id: 'section-8', title: '7. Estilo de vida' },
            { id: 'section-9', title: '8. O aliado ASMR' },
            { id: 'section-10', title: '9. Evitando Gatilhos' },
            { id: 'section-11', title: '10. Pergunte √† IA' }, 
            { id: 'section-12', title: '11. ‚ú® Gerador de Afirma√ß√µes Positivas' }, 
            { id: 'section-13', title: '12. üí° Expansor de T√≥picos' },       
            { id: 'section-14', title: '13. T√©cnicas Aprofundadas' }, 
            { id: 'section-15', title: '14. Ch√°s e Ervas Calmantes' },      
            { id: 'section-16', title: '15. Receitas para a Mente' },       
            { id: 'section-17', title: '16. A Import√¢ncia dos Exerc√≠cios F√≠sicos' }, 
            { id: 'section-18', title: '17. Conclus√£o' },                   
            { id: 'section-19', title: '18. Sobre o autor' }                 
        ];
        let currentSectionIndex = 0;
        let currentFontSize = 100;
        // The initial chatHistory for the AI Psychologist
        let chatHistory = [{ role: "user", parts: [{ text: "Voc√™ √© um assistente de bem-estar e psicologia. Seu objetivo √© fornecer informa√ß√µes gerais, suporte emocional e recursos sobre ansiedade e sa√∫de mental. Voc√™ n√£o √© um profissional de sa√∫de mental licenciado e n√£o pode diagnosticar ou tratar condi√ß√µes m√©dicas. Sempre recomende a busca por ajuda profissional para qualquer preocupa√ß√£o s√©ria. Responda de forma emp√°tica e √∫til." }] }];

        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const progressIndicator = document.getElementById('progress-indicator');
        const contentArea = document.getElementById('contentArea');
        const fontSizeIndicator = document.getElementById('fontSizeIndicator');
        const darkModeToggle = document.getElementById('darkModeToggle');
        const navMenu = document.getElementById('navMenu');
        const menuBtn = document.getElementById('menuBtn');

        // Quiz elements
        const quizQuestionsContainer = document.getElementById('quizQuestionsContainer');
        const calculateQuizResultBtn = document.getElementById('calculateQuizResultBtn');
        const quizResultDisplay = document.getElementById('quizResultDisplay');

        const quizQuestions = [
            "Sinto preocupa√ß√£o excessiva na maioria dos dias.",
            "Tenho dificuldade para controlar a preocupa√ß√£o.",
            "Sinto-me inquieto(a) ou com os nervos √† flor da pele.",
            "Sinto tens√£o muscular frequente (ombros, pesco√ßo).",
            "Tenho dificuldade para me concentrar ou minha mente fica 'em branco'.",
            "Sou facilmente fatigado(a) ou me canso com facilidade.",
            "Tenho problemas com o sono (dificuldade para adormecer, sono interrompido).",
            "Sinto palpita√ß√µes ou o cora√ß√£o acelerado sem motivo aparente.",
            "Experimento falta de ar ou sensa√ß√£o de sufocamento.",
            "Evito situa√ß√µes sociais por medo de ser julgado(a)."
        ];

        // AI Chat elements
        const chatInput = document.getElementById('chatInput');
        const sendChatBtn = document.getElementById('sendChatBtn');
        const chatDisplay = document.getElementById('chatDisplay');
        const loadingIndicator = document.getElementById('loadingIndicator');

        // New AI Feature Elements (Affirmation Generator & Topic Expander)
        const generateAffirmationBtn = document.getElementById('generateAffirmationBtn');
        const affirmationDisplay = document.getElementById('affirmationDisplay');
        const affirmationLoadingIndicator = document.getElementById('affirmationLoadingIndicator');

        const topicInput = document.getElementById('topicInput');
        const askTopicBtn = document.getElementById('askTopicBtn');
        const topicResponseDisplay = document.getElementById('topicResponseDisplay');
        const topicLoadingIndicator = document.getElementById('topicLoadingIndicator');

        // Message Box elements
        const messageBox = document.getElementById('messageBox');
        const messageText = document.getElementById('messageText');
        const closeMessageBox = document.getElementById('closeMessageBox');

        function showMessageBox(message) {
            messageText.textContent = message;
            messageBox.style.display = 'block';
        }

        closeMessageBox.addEventListener('click', () => {
            messageBox.style.display = 'none';
        });

        // ASMR link handler
        const asmrLink = document.getElementById('asmrLink');
        if (asmrLink) {
            asmrLink.addEventListener('click', (e) => {
                e.preventDefault();
                showMessageBox("Por favor, substitua [Inserir link do v√≠deo aqui] pelo link real do seu v√≠deo ASMR para que esta funcionalidade funcione.");
            });
        }


        function populateNavMenu() {
            navMenu.innerHTML = '';
            sections.forEach((section, index) => {
                const menuItem = document.createElement('a');
                menuItem.href = '#';
                menuItem.textContent = section.title;
                menuItem.className = 'block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-200 dark:hover:bg-gray-600';
                menuItem.addEventListener('click', (e) => {
                    e.preventDefault();
                    showSection(index);
                    navMenu.classList.add('hidden');
                });
                navMenu.appendChild(menuItem);
            });
        }
        
        function updateButtons() {
            prevBtn.disabled = currentSectionIndex === 0;
            nextBtn.disabled = currentSectionIndex === sections.length - 1;
            prevBtn.classList.toggle('opacity-50', prevBtn.disabled);
            prevBtn.classList.toggle('cursor-not-allowed', prevBtn.disabled);
            nextBtn.classList.toggle('opacity-50', nextBtn.disabled);
            nextBtn.classList.toggle('cursor-not-allowed', nextBtn.disabled);
        }

        function showSection(index) {
            if (index < 0 || index >= sections.length) return;
            
            const allSections = document.querySelectorAll('.ebook-section');
            allSections.forEach(section => {
                section.classList.remove('active'); // Remove 'active' from all to hide them
            });
            
            const newSection = document.getElementById(sections[index].id);
            if (newSection) {
                newSection.classList.add('active'); // Add 'active' to the target section to show it
            }

            currentSectionIndex = index;
            updateButtons();
            progressIndicator.textContent = `P√°gina ${index + 1} de ${sections.length}`;
        }
        
        function changeFontSize(delta) {
            currentFontSize = Math.max(80, Math.min(150, currentFontSize + delta));
            contentArea.style.fontSize = `${currentFontSize}%`;
            fontSizeIndicator.textContent = `${currentFontSize}%`;
            localStorage.setItem('ebookFontSize', currentFontSize);
        }

        function toggleDarkMode(isDark) {
            if (isDark) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
            localStorage.setItem('ebookDarkMode', isDark);
        }

        // --- Quiz Functions ---
        function renderQuiz() {
            if (!quizQuestionsContainer) return; // Ensure quiz container exists before rendering
            quizQuestionsContainer.innerHTML = '';
            quizQuestions.forEach((questionText, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'quiz-question-item';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `quiz-q-${index}`;
                checkbox.name = `quiz-q-${index}`;
                
                const label = document.createElement('label');
                label.htmlFor = `quiz-q-${index}`;
                label.textContent = questionText;
                label.style.color = 'var(--text-color)'; // Apply color variable to label
                
                questionDiv.appendChild(checkbox);
                questionDiv.appendChild(label);
                quizQuestionsContainer.appendChild(questionDiv);
            });
        }

        function calculateQuizResult() {
            if (!quizQuestionsContainer || !quizResultDisplay) return; // Ensure elements exist
            let score = 0;
            const checkboxes = quizQuestionsContainer.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    score++;
                }
            });

            let resultMessage = '';
            let resultClass = ''; // For potential styling based on result
            if (score >= 0 && score <= 3) {
                resultMessage = `Voc√™ marcou ${score} itens. **N√≠vel de Ansiedade: BAIXO.** Parece que voc√™ tem pouca ou nenhuma ansiedade no momento. Continue cuidando de si e mantendo um estilo de vida equilibrado!`;
                resultClass = 'text-green-600 dark:text-green-400';
            } else if (score >= 4 && score <= 6) {
                resultMessage = `Voc√™ marcou ${score} itens. **N√≠vel de Ansiedade: MODERADO.** Voc√™ pode estar experimentando n√≠veis moderados de ansiedade. As t√©cnicas de relaxamento e respira√ß√£o (Cap. 5 e 11), os ch√°s (Cap. 12) e os exerc√≠cios f√≠sicos (Cap. 16) deste e-book podem ser muito √∫teis para voc√™. Considere explorar os recursos para autoconhecimento (Cap. 13).`;
                resultClass = 'text-yellow-600 dark:text-yellow-400';
            } else if (score >= 7 && score <= 10) {
                resultMessage = `Voc√™ marcou ${score} itens. **N√≠vel de Ansiedade: ELEVADO.** Seus sintomas indicam um n√≠vel elevado de ansiedade. √â altamente recomendado buscar apoio profissional, como terapia com um psic√≥logo ou psiquiatra. As ferramentas deste e-book podem servir como um complemento valioso, mas a ajuda especializada √© crucial.`;
                resultClass = 'text-red-600 dark:text-red-400';
            }

            quizResultDisplay.innerHTML = resultMessage; // Use innerHTML to allow bold text
            quizResultDisplay.className = `quiz-result ${resultClass}`; // Apply class for coloring
            quizResultDisplay.classList.remove('hidden');
        }

        // --- Gemini API Call Functions ---
        // Function to handle AI chat (Pergunte √† IA)
        async function handleAIChat() {
            if (!chatInput || !sendChatBtn || !chatDisplay || !loadingIndicator) return;

            const userMessage = chatInput.value.trim();
            if (!userMessage) {
                return; // Do nothing if input is empty
            }

            // Display user message
            const userMsgDiv = document.createElement('div');
            userMsgDiv.className = 'chat-message user';
            userMsgDiv.textContent = userMessage;
            chatDisplay.appendChild(userMsgDiv);
            chatDisplay.scrollTop = chatDisplay.scrollHeight;

            loadingIndicator.classList.remove('hidden');
            sendChatBtn.disabled = true;
            chatInput.disabled = true;
            chatInput.value = ''; // Clear input immediately

            chatHistory.push({ role: "user", parts: [{ text: userMessage }] });
            const payload = { contents: chatHistory };
            const apiKey = "AIzaSyD-RemdW1m1T5863zBJo6D_H97dih5nT0I"; // SUA CHAVE DE API AQUI
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const aiText = result.candidates[0].content.parts[0].text;
                    chatHistory.push({ role: "model", parts: [{ text: aiText }] });
                    const aiMsgDiv = document.createElement('div');
                    aiMsgDiv.className = 'chat-message ai';
                    aiMsgDiv.textContent = aiText;
                    chatDisplay.appendChild(aiMsgDiv);
                } else {
                    const errorMsgDiv = document.createElement('div');
                    errorMsgDiv.className = 'chat-message ai';
                    errorMsgDiv.textContent = "Desculpe, n√£o consegui gerar uma resposta. Tente novamente ou verifique sua chave de API.";
                    chatDisplay.appendChild(errorMsgDiv);
                }
            } catch (error) {
                console.error("Erro ao chamar a API Gemini:", error);
                const errorMsgDiv = document.createElement('div');
                errorMsgDiv.className = 'chat-message ai';
                errorMsgDiv.textContent = "Ocorreu um erro ao conectar com a IA. Verifique sua conex√£o ou chave de API.";
                chatDisplay.appendChild(errorMsgDiv);
            } finally {
                loadingIndicator.classList.add('hidden');
                sendChatBtn.disabled = false;
                chatInput.disabled = false;
                chatInput.focus();
                chatDisplay.scrollTop = chatDisplay.scrollHeight; // Scroll to bottom
            }
        }

        // Function to generate a positive affirmation
        async function generateAffirmation() {
            if (!affirmationDisplay || !generateAffirmationBtn || !affirmationLoadingIndicator) return;

            affirmationLoadingIndicator.classList.remove('hidden');
            generateAffirmationBtn.disabled = true;
            affirmationDisplay.textContent = ''; // Clear previous affirmation

            const prompt = "Gere uma afirma√ß√£o positiva curta e inspiradora focada em lidar com a ansiedade, resili√™ncia ou bem-estar mental. Comece com 'Eu sou...' ou 'Eu consigo...'. Responda apenas a afirma√ß√£o, sem introdu√ß√µes ou conclus√µes.";
            // Use a minimal chat history for single requests, not needing full conversation context
            const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] }; 
            const apiKey = "AIzaSyD-RemdW1m1T5863zBJo6D_H97dih5nT0I"; // SUA CHAVE DE API AQUI
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    affirmationDisplay.textContent = result.candidates[0].content.parts[0].text;
                } else {
                    affirmationDisplay.textContent = "N√£o foi poss√≠vel gerar uma afirma√ß√£o. Verifique sua chave de API.";
                }
            } catch (error) {
                console.error("Erro ao gerar afirma√ß√£o:", error);
                affirmationDisplay.textContent = "Erro de conex√£o. Por favor, insira sua chave de API ou verifique sua conex√£o.";
            } finally {
                affirmationLoadingIndicator.classList.add('hidden');
                generateAffirmationBtn.disabled = false;
            }
        }

        // Function to expand a topic based on user input
        async function expandTopic() {
            if (!topicInput || !askTopicBtn || !topicResponseDisplay || !topicLoadingIndicator) return;

            const userQuestion = topicInput.value.trim();
            if (!userQuestion) {
                topicResponseDisplay.textContent = "Por favor, digite uma pergunta ou t√≥pico para expandir.";
                return;
            }

            topicLoadingIndicator.classList.remove('hidden');
            askTopicBtn.disabled = true;
            topicInput.disabled = true;
            topicResponseDisplay.textContent = ''; // Clear previous response

            const prompt = `Expanda sobre o seguinte t√≥pico ou responda √† pergunta sobre ansiedade e bem-estar mental de forma concisa e √∫til. Mantenha a resposta entre 50 e 150 palavras, sem introdu√ß√µes como 'Claro' ou 'Aqui est√°', e sem conclus√µes: "${userQuestion}".`;
            const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] }; 
            const apiKey = "AIzaSyD-RemdW1m1T5863zBJo6D_H97dih5nT0I"; // SUA CHAVE DE API AQUI
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    topicResponseDisplay.textContent = result.candidates[0].content.parts[0].text;
                } else {
                    topicResponseDisplay.textContent = "N√£o foi poss√≠vel expandir o t√≥pico. Tente reformular sua pergunta ou verifique sua chave de API.";
                }
            } catch (error) {
                console.error("Erro ao expandir t√≥pico:", error);
                topicResponseDisplay.textContent = "Erro de conex√£o. Por favor, insira sua chave de API ou verifique sua conex√£o.";
            } finally {
                topicLoadingIndicator.classList.add('hidden');
                askTopicBtn.disabled = false;
                topicInput.disabled = false;
            }
        }


        // --- Event Listeners ---
        prevBtn.addEventListener('click', () => {
            if (sections[currentSectionIndex] && sections[currentSectionIndex].id === 'section-5') {
                quizResultDisplay.classList.add('hidden'); 
            }
            showSection(currentSectionIndex - 1);
        });
        nextBtn.addEventListener('click', () => {
            if (sections[currentSectionIndex] && sections[currentSectionIndex].id === 'section-5') {
                quizResultDisplay.classList.add('hidden');
            }
            showSection(currentSectionIndex + 1);
        });
        
        document.getElementById('increaseFontBtn').addEventListener('click', () => changeFontSize(10));
        document.getElementById('decreaseFontBtn').addEventListener('click', () => changeFontSize(-10));

        darkModeToggle.addEventListener('change', (e) => toggleDarkMode(e.target.checked));
        
        menuBtn.addEventListener('click', () => navMenu.classList.toggle('hidden'));
        document.addEventListener('click', (e) => {
            if (!menuBtn.contains(e.target) && !navMenu.contains(e.target)) {
                navMenu.classList.add('hidden');
            }
        });

        // Quiz Event Listeners
        if (calculateQuizResultBtn) {
            calculateQuizResultBtn.addEventListener('click', calculateQuizResult);
        }
        // Initialize quiz questions if the container exists
        if (quizQuestionsContainer) {
            renderQuiz();
        }

        // AI Chat Event Listeners
        if (sendChatBtn) {
            sendChatBtn.addEventListener('click', handleAIChat);
            if (chatInput) {
                chatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendChatBtn.click();
                    }
                });
            }
        }
        
        // New AI Feature Event Listeners
        if (generateAffirmationBtn) {
            generateAffirmationBtn.addEventListener('click', generateAffirmation);
        }
        if (askTopicBtn) {
            askTopicBtn.addEventListener('click', expandTopic);
            if (topicInput) {
                topicInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        askTopicBtn.click();
                    }
                });
            }
        }

        // Initialization
        window.onload = () => {
            // Restore Dark Mode
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const savedDarkMode = localStorage.getItem('ebookDarkMode');
            if (savedDarkMode !== null) {
                darkModeToggle.checked = savedDarkMode === 'true';
            } else {
                darkModeToggle.checked = prefersDark;
            }
            toggleDarkMode(darkModeToggle.checked);

            // Restore Font Size
            const savedFontSize = localStorage.getItem('ebookFontSize');
            if (savedFontSize) {
                currentFontSize = parseInt(savedFontSize, 10);
                changeFontSize(0); 
            }
            
            populateNavMenu();
            showSection(0);
        };
    </script>
</body>
</html>
